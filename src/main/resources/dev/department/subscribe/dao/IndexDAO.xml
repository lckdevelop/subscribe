<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dev.department.subscribe.dao.IndexDAO">
	<select id="getBranSubsList" parameterType="int" resultType="BrandDTO" >		
		select b.no, b.name, b.engname, decode(s.member_no, #{memNo}, 1, 0) as subsed
		from brand b
		left outer join subs s
		on b.no = s.brand_no
	</select>

	<select id="getMemSubs" parameterType="int" resultType="BrandDTO" >		
		select b.no, b.name, b.engname
		from subs s
		join brand b
		on s.brand_no = b.no
		where member_no = #{memNo}	
	</select>
	
	<select id="getMemNotSubs" parameterType="int" resultType="BrandDTO" >		
		select b.no, b.name, b.engname
		from brand b
		left outer join 
		(select b.no as brandno, b.name, b.engname
		from subs s
		join brand b
		on s.brand_no = b.no
		where member_no = #{memNo}) subsed
		on b.no = subsed.brandno
		where subsed.brandno is null	
	</select>
	
	<delete id="brandSubsCancel" parameterType="SubsDTO">
		delete from subs
		where member_no = #{memberNo}
		and brand_no = #{brandNo}	
	</delete>
	
	<update id="subsCntMinUpdate" parameterType="int">
		update brand
		set subscount = subscount - 1
		where no = #{brandNo}
	</update>
	
	<insert id="brandSubsEnroll" parameterType="SubsDTO">
		insert into subs
		values
		(subs_id_seq.nextval, #{brandNo}, #{memberNo})
	</insert>
	
	<update id="subsCntPlusUpdate" parameterType="int">
		update brand
		set subscount = subscount + 1
		where no = #{brandNo}
	</update>
	
	<select id="brandNewsList" resultType="BrandNewsDTO">
		SELECT b.no, b.name, bn.title, bn.uploaddate, bn.content
		FROM BRANDNEWS bn
		JOIN BRAND b
		ON bn.brand_no = b.no
	</select>
</mapper>